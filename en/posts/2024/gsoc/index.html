<!doctype html><html lang=en-us><head><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=robots content="index, follow"><meta name=revisit-after content="15 days"><link rel=author href=/humans.txt><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileImage content="/mstile-144x144.png"><meta name=author content="schnellerhase"><meta itemprop=name content="Google Summer of Code 2024 - 'Multigrid for FEniCSx'"><meta itemprop=description content="Intro This is the report on the Google Summer of Code 2024 project &lsquo;Multigrid for FEniCSx&rsquo; with the umbrella organization NumFOCUS on the FEniCS Project sponsored since 2016 by NumFOCUS.
The FEniCS project&rsquo;s main component is the solving environment DOLFINx. Where the &lsquo;x&rsquo; indicates the new version over the former (now legacy) DOLFIN. Even though the goal of both, the legacy and currently delevoped, projects is identical - new requirements, technology and past learnings motivated the rewrite and redisign into a new library."><meta itemprop=datePublished content="2024-08-22T22:47:31+02:00"><meta itemprop=dateModified content="2024-08-26T15:44:22+02:00"><meta itemprop=wordCount content="1264"><meta itemprop=keywords content><meta property="og:title" content="Google Summer of Code 2024 - 'Multigrid for FEniCSx'"><meta property="og:description" content="Intro This is the report on the Google Summer of Code 2024 project &lsquo;Multigrid for FEniCSx&rsquo; with the umbrella organization NumFOCUS on the FEniCS Project sponsored since 2016 by NumFOCUS.
The FEniCS project&rsquo;s main component is the solving environment DOLFINx. Where the &lsquo;x&rsquo; indicates the new version over the former (now legacy) DOLFIN. Even though the goal of both, the legacy and currently delevoped, projects is identical - new requirements, technology and past learnings motivated the rewrite and redisign into a new library."><meta property="og:type" content="article"><meta property="og:url" content="https://schnellerhase.github.io/en/posts/2024/gsoc/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-22T22:47:31+02:00"><meta property="article:modified_time" content="2024-08-26T15:44:22+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Google Summer of Code 2024 - 'Multigrid for FEniCSx'"><meta name=twitter:description content="Intro This is the report on the Google Summer of Code 2024 project &lsquo;Multigrid for FEniCSx&rsquo; with the umbrella organization NumFOCUS on the FEniCS Project sponsored since 2016 by NumFOCUS.
The FEniCS project&rsquo;s main component is the solving environment DOLFINx. Where the &lsquo;x&rsquo; indicates the new version over the former (now legacy) DOLFIN. Even though the goal of both, the legacy and currently delevoped, projects is identical - new requirements, technology and past learnings motivated the rewrite and redisign into a new library."><title>Google Summer of Code 2024 - 'Multigrid for FEniCSx'</title><link rel="stylesheet dns-prefetch preconnect preload prefetch" as=style href=https://schnellerhase.github.io/css/style.min.27ddca24c76e61cf4d8891e6aef5c9042c19a29e8d028d01dbd1019067769d4d.css integrity="sha256-J93KJMduYc9NiJHmrvXJBCwZop6NAo0B29EBkGd2nU0=" crossorigin=anonymous></head><body id=page><header id=site-header class="animated slideInUp"><div class="hdr-wrapper section-inner"><div class=hdr-left><div class=site-branding><a href=https://schnellerhase.github.io/>schnellerhase</a></div><nav class="site-nav hide-in-mobile"><a href=https://schnellerhase.github.io/en/posts/>Posts</a><a href=https://schnellerhase.github.io/en/about/>About</a></nav></div><div class="hdr-right hdr-icons"><button id=toc-btn class="hdr-btn desktop-only-ib" title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-list"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3" y2="6"/><line x1="3" y1="12" x2="3" y2="12"/><line x1="3" y1="18" x2="3" y2="18"/></svg></button><span class="hdr-social hide-in-mobile"><a href=https://github.com/schnellerhase target=_blank rel="noopener me" title=Github><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></span><button id=share-btn class=hdr-btn title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg></button><div id=share-links class="animated fast"><ul><li><a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=https%3a%2f%2fschnellerhase.github.io%2fen%2fposts%2f2024%2fgsoc%2f&amp;text=Google%20Summer%20of%20Code%202024%20-%20%27Multigrid%20for%20FEniCSx%27" target=_blank rel=noopener aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path class="st0" d="m21.3 21.1L9.9 2.9H2.7l11.4 18.2zm-18.6.0 7.2-6.6m4.2-5 7.2-6.6"/></svg></a></li><li><a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fschnellerhase.github.io%2fen%2fposts%2f2024%2fgsoc%2f" target=_blank rel=noopener aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"/></svg></a></li><li><a href="mailto:?subject=Google%20Summer%20of%20Code%202024%20-%20%27Multigrid%20for%20FEniCSx%27&amp;body=https%3a%2f%2fschnellerhase.github.io%2fen%2fposts%2f2024%2fgsoc%2f" target=_self rel=noopener aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1.0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1.0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fschnellerhase.github.io%2fen%2fposts%2f2024%2fgsoc%2f&amp;source=https://schnellerhase.github.io/&amp;title=Google%20Summer%20of%20Code%202024%20-%20%27Multigrid%20for%20FEniCSx%27&amp;summary=Google%20Summer%20of%20Code%202024%20-%20%27Multigrid%20for%20FEniCSx%27%2c%20by%20schnellerhase%0a%0a%3cnil%3e%0a" target=_blank rel=noopener aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a></li><li><a href=# onclick="return linkShare(&#34;Google Summer of Code 2024 - 'Multigrid for FEniCSx'&#34;,&#34;https://schnellerhase.github.io/en/posts/2024/gsoc/&#34;,`Google Summer of Code 2024 - 'Multigrid for FEniCSx', by schnellerhase

<nil>
`),!1" target=_self rel=noopener aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></a></li></ul></div><button id=menu-btn class=hdr-btn title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button></div></div></header><div id=mobile-menu class="animated fast"><ul><li><a href=https://schnellerhase.github.io/en/posts/>Posts</a></li><li><a href=https://schnellerhase.github.io/en/about/>About</a></li></ul></div><main class="site-main section-inner animated fadeIn faster"><article class=thin><header class=post-header><div class=post-meta><span>Aug 22, 2024</span></div><h1>Google Summer of Code 2024 - 'Multigrid for FEniCSx'</h1></header><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 00-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg><a href=/en/about/ target=_blank>schnellerhase</a></p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>1264 Words
Read time
5 Minutes, 44 Seconds</p><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>2024-08-22 20:47 +0000</p></div><hr class=post-end><div class=content><h2 id=intro>Intro<a href=#intro class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>This is the report on the Google Summer of Code 2024 project <a href=https://summerofcode.withgoogle.com/programs/2024/projects/YhEwl8iB>&lsquo;Multigrid for FEniCSx&rsquo;</a> with the umbrella organization <a href=https://numfocus.org/>NumFOCUS</a> on the <a href=https://fenicsproject.org/>FEniCS Project</a> sponsored since 2016 by NumFOCUS.</p><p>The FEniCS project&rsquo;s main component is the solving environment <a href=https://doi.org/10.5281/zenodo.10447666>DOLFINx</a>.
Where the &lsquo;x&rsquo; indicates the new version over the former (now legacy) <a href=https://doi.org/10.11588/ans.2015.100.20553>DOLFIN</a>.
Even though the goal of both, the legacy and currently delevoped, projects is identical - new requirements, technology and past learnings motivated the rewrite and redisign into a new library.</p><p>Coming soon: People involved, mentors?</p><h2 id=geometric-multigrid-and-an-application-to-gsoc>Geometric Multigrid and an Application to GSOC<a href=#geometric-multigrid-and-an-application-to-gsoc class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Coming soon&mldr;</p><h2 id=implementation-decisions>Implementation decisions<a href=#implementation-decisions class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>As a first step in the research and getting up to speed phase, it was necessary to figure out what the FEniCS project wants to achieve with a geometric multigrid implemenation.
Its interaction with other, arleady present and future, features and the overall design principles of the DOLFINx code base played a major role during this phase.
Let us shortly recap some of the findings and their consequences for the project.</p><p>One of the fundamental design choices of DOLFINx (also in contrast to its predecessor) is the data driven design.
Functionality should be provided on standard data containers holding the necessary information, without further encapsulation and object based data wrapping and implicit expectations on data or objects are to be kept to a minimum.
As a main motivation for this the extensibility and usability outside the initial thought out scope of a given functionality, are to be named.</p><p>For the multigrid implementation this resulted, after carefull consideration, in the decision to make the transfer an explicit function that needs to be provided explicitly for a certain use case.
This is a different path of choice, then what for example Firedrake (see <a href=https://www.firedrakeproject.org/demos/geometric_multigrid.py.html>here</a>) and PETSc (see <a href=https://petsc.org/release/manualpages/PC/PCGAMG/>here</a>) support with the very implicit construction of transfer operations under the hood, without the user needing to deal with any of it explicitly.</p><p>Besides more explicity for the user, the design should also, in principle, allow for higher performance or at least greater control over it as features are not employed if not chosen by the user.</p><p>TODO: big picutre, after intro (loss of big picture: p-multigrid, domain decomposition)</p><ul><li>decision on strictly refinement inclusions</li><li>non matching meshes interpolation -> duality problem</li></ul><h2 id=interval-refinement-in-dolfinx>Interval Refinement in DOLFINx<a href=#interval-refinement-in-dolfinx class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>So, the logical step for getting started with a geometric multigrid in the setting of mesh hirachies produced by refinement routines is naturally the one dimensional case, i.e. interval meshes.
However DOLFINx at the time did not provide any such routine.
So as a first major step the implementation of a one dimensional refinement routine was addressed, and resulted in a (merged) <a href=https://github.com/FEniCS/dolfinx/pull/3314>pull request</a>.</p><p>TODO: mesh stored data and aspects of parallization
TODO: algorithm of choice
TODO: output: parent cells</p><p>For the debugging of the code, especially in parallel, looking at visualizations of the pre- and post-refinement meshes was a crucial step.
This was easy to do thanks to the handy <a href=https://github.com/nate-sime/febug>febug</a> tool, making visualization of different mesh entites straight forward and simple.</p><p>TODO: A story on asserts in python and cpp module</p><p>TODO: unifiying refinement interface (also optionals and python export)</p><h2 id=the-transfer-matrix>The Transfer Matrix<a href=#the-transfer-matrix class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Coming soon&mldr;</p><ul><li>parallization and ghost nodes</li><li>graph partitioning</li></ul><h2 id=geometric-twogrid-example>Geometric Twogrid Example<a href=#geometric-twogrid-example class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>Coming soon&mldr;</p><h2 id=general-code-contributions>General Code Contributions<a href=#general-code-contributions class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h2><p>While the main project focused on the implementation of a geometric multigrid a lot of incidental and supportive changes where contributed to different repositories as well.
Split across multiple repositories, we want to shortly outline the highlights of these in chronological order.</p><h3 id=dolfinx---introduce-aliasing-for-mdspan-closedhttpsgithubcomfenicsdolfinxpull3116>DOLFINx - Introduce aliasing for mdspan <a href=https://github.com/FEniCS/dolfinx/pull/3116>(Closed)</a><a href=#dolfinx---introduce-aliasing-for-mdspan-closedhttpsgithubcomfenicsdolfinxpull3116 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>The <code>mdspan</code> library in use with the FEniCS Project is based on the Kokkos <a href=https://github.com/kokkos/mdspan>refrence implementation</a>.
To facilitate the namespace switching depending on compiler support of either <code>std::experimental::mdspan</code> or <code>std::mdspan</code> or none of the above the implementation introduces the macro <code>MDSPAN_IMPL_STANDARD_NAMESPACE</code>.
This causes bloated calls, i.e. everytime it is necessary to write out <code>MDSPAN_IMPL_STANDARD_NAMESPACE::mdspan</code>.
In the pull request this was suggested to be warpped into a custom hiding layer, i.e. allowing for access via <code>dolfinx::common::mdspan</code>, no matter to what this dispatches to.
This would also allow the code to remain untouched in the future if one updates to the STL versions.
After a discussion the changes were rejected, due to it being considered an approximation of a third-party librarby.</p><h3 id=basix---update-mdspan-mergedhttpsgithubcomfenicsbasixpull840>Basix - Update mdspan <a href=https://github.com/FEniCS/basix/pull/840>(Merged)</a><a href=#basix---update-mdspan-mergedhttpsgithubcomfenicsbasixpull840 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Update to new Kokkos single header <code>mdspan</code> changes.</p><h3 id=dolfinx---make-compile-time-options-compile-time-constants-mergedhttpsgithubcomfenicsdolfinxpull3246>DOLFINx - Make compile time options compile time constants <a href=https://github.com/FEniCS/dolfinx/pull/3246>(Merged)</a><a href=#dolfinx---make-compile-time-options-compile-time-constants-mergedhttpsgithubcomfenicsdolfinxpull3246 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Previously in translation units wrapped transformation of compiler flag was moved to header files in combination with the usage of <code>consteval</code> to make them truely compile time constants.
The idiom of the changes was for a given (<code>cmake</code>) flag <code>FLAG</code> is demonstrated below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>consteval</span> <span class=kt>bool</span> <span class=nf>has_flag</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cp>#ifdef FLAG
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=k>return</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>}</span>
</span></span></code></pre></div><h3 id=dolfinx---some-updates-for-mesh-generation-openhttpsgithubcomfenicsdolfinxpull3275>DOLFINx - Some updates for mesh generation <a href=https://github.com/FEniCS/dolfinx/pull/3275>(Open)</a><a href=#dolfinx---some-updates-for-mesh-generation-openhttpsgithubcomfenicsdolfinxpull3275 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Whilst reading up the mesh related data structures in DOLFINx for the project, I notices quite a few sub-optimal code paths in the generation code of meshes.
In this PR these were adressed, mostly consisting of modernizations, simplifications and some additional testing.
The modernizations also made use of the previously (in the FEniCS Project) unused <a href=https://en.cppreference.com/w/cpp/ranges>ranges library</a>, this was the trigger for looking into the following 12 pull requests.</p><h3 id=basix---update-to-stdranges-usage-mergedhttpsgithubcomfenicsbasixpull837>Basix - Update to std::ranges usage <a href=https://github.com/FEniCS/basix/pull/837>(Merged)</a><a href=#basix---update-to-stdranges-usage-mergedhttpsgithubcomfenicsbasixpull837 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Made use of all <code>C++20</code> available ranges algorithms in the Basix code base.</p><h3 id=basix---c23-support-revertedhttpsgithubcomfenicsbasixpull838>Basix - C++23 Support <a href=https://github.com/FEniCS/basix/pull/838>(Reverted)</a><a href=#basix---c23-support-revertedhttpsgithubcomfenicsbasixpull838 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Some important parts of the ranges library were missed in <code>C++20</code>, and are only available from <code>C++23</code> onward.
So to check general compatibility of the FEniCS packages with <code>C++23</code> we looked into the root dependency Basix and confirmed that we it is <code>C++23</code> ready in this PR.
This move to the <code>C++23</code> standard was later on reverted, and it was decided on to (not yet) switch to <code>C++23</code> but remain with <code>C++20</code> for now mainly due to lacking compiler support.</p><h3 id=dolfinx---update-to-stdranges-usage>DOLFINx - Update to <code>std::ranges</code> usage<a href=#dolfinx---update-to-stdranges-usage class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>Modernization to range based algorithms across all of DOLFINx, split up into several PR&rsquo;s:</p><ul><li>Replace <code>std::sort</code> with <code>std::ranges::sort</code> <a href=https://github.com/FEniCS/dolfinx/pull/3293>(Merged)</a></li><li>Replace <code>std::fill</code> with <code>std::ranges::fill</code> <a href=https://github.com/FEniCS/dolfinx/pull/3294>(Merged)</a></li><li>Replace <code>std::lower/uper_bound</code> with <code>std::ranges::lower/uper_bound</code> <a href=https://github.com/FEniCS/dolfinx/pull/3295>(Merged)</a></li><li>Replace <code>std::for_each</code> with <code>std::ranges::for_each</code> <a href=https://github.com/FEniCS/dolfinx/pull/3296>(Merged)</a></li><li>Replace <code>std::transform</code> with <code>std::ranges::transform</code> <a href=https://github.com/FEniCS/dolfinx/pull/3297>(Merged)</a></li><li>Replace <code>std::set_*</code> with <code>std::ranges::set_*</code> <a href=https://github.com/FEniCS/dolfinx/pull/3298>(Merged)</a></li><li>Replace <code>std::copy</code> with <code>std::ranges::copy</code> <a href=https://github.com/FEniCS/dolfinx/pull/3299>(Merged)</a></li><li>Replace <code>std::min/max</code> with <code>std::ranges::min/max</code> <a href=https://github.com/FEniCS/dolfinx/pull/3300>(Merged)</a></li><li>Replace <code>std::unique</code> with <code>std::ranges::unique</code> <a href=https://github.com/FEniCS/dolfinx/pull/3315>(Merged)</a></li></ul><h3 id=rework-radix_sort-mergedhttpsgithubcomfenicsdolfinxpull3313>Rework <code>radix_sort</code> <a href=https://github.com/FEniCS/dolfinx/pull/3313>(Merged)</a><a href=#rework-radix_sort-mergedhttpsgithubcomfenicsdolfinxpull3313 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>While updating from <code>std::sort</code> to <code>std::ranges::sort</code>, I noted, that the custom DOLFINx implementation of radix sort <code>radix_sort</code> (which is used for performance critical sorting of degree of freedom indices mostly), is not compatible with the ranges interface.
In this pull request a range based <code>radix_sort</code> was introduced, which allows for &rsquo;equal&rsquo; usage as <code>std::ranges::sort</code>.
For this the operator based approach as in the ranges library was followed and a projection routine for the elements can be injected.
This enabled for the removal of the previously also hand coded <code>argsort_radix</code> in DOLFINx, leaving only one <code>radix_sort</code> functionality left.
Due to its performance relevance the changes where benchmarked <a href=https://github.com/schnellerhase/dolfinx/pull/24>here</a> and showed that the higher quality code is also the faster one.</p><h3 id=favor-exterior_facet_indices-over-locate_entities_boundary-for-retrieving-complete-boundary-mergedhttpsgithubcomfenicsdolfinxpull3283>Favor <code>exterior_facet_indices</code> over <code>locate_entities_boundary</code> for retrieving complete boundary <a href=https://github.com/FEniCS/dolfinx/pull/3283>(Merged)</a><a href=#favor-exterior_facet_indices-over-locate_entities_boundary-for-retrieving-complete-boundary-mergedhttpsgithubcomfenicsdolfinxpull3283 class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><p>This pull request adressed the observation that when all boundary entites need to be selected in FEniCSx to construct a Dirichlet boundary condition on it, we must not filter these with a specific lambda as the default interface of <code>locate_entities_boundary</code> requires, but rather use the <code>exterior_facet_indices</code> which just gets all boundary facets.
This triggered a (still ongoing) discussion on optional arguments in the DOLFINx code base and its implications to the exported python module.</p><h3 id=some-other-stritcly-maintenance-prs>Some other stritcly maintenance PR&rsquo;s<a href=#some-other-stritcly-maintenance-prs class=anchor aria-hidden=true><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 015 5 5 5 0 01-5 5h-3m-6 0H6a5 5 0 01-5-5 5 5 0 015-5h3"/><line x1="8" y1="12" x2="16" y2="12"/></svg></a></h3><ul><li>DOLFINx - Fix ruff check <a href=https://github.com/FEniCS/dolfinx/pull/3349>(Merged)</a></li><li>febug - Fix installation with <code>dolfinx</code> main <a href=https://github.com/nate-sime/febug/pull/13>(Merged)</a></li><li>FEniCS/web - Fix CI <a href=https://github.com/FEniCS/web/pull/187>(Merged)</a></li></ul></div></article><aside id=toc><div class=toc-title>Table of Contents</div><nav id=TableOfContents><ul><li><a href=#intro>Intro</a></li><li><a href=#geometric-multigrid-and-an-application-to-gsoc>Geometric Multigrid and an Application to GSOC</a></li><li><a href=#implementation-decisions>Implementation decisions</a></li><li><a href=#interval-refinement-in-dolfinx>Interval Refinement in DOLFINx</a></li><li><a href=#the-transfer-matrix>The Transfer Matrix</a></li><li><a href=#geometric-twogrid-example>Geometric Twogrid Example</a></li><li><a href=#general-code-contributions>General Code Contributions</a><ul><li><a href=#dolfinx---introduce-aliasing-for-mdspan-closedhttpsgithubcomfenicsdolfinxpull3116>DOLFINx - Introduce aliasing for mdspan <a href=https://github.com/FEniCS/dolfinx/pull/3116>(Closed)</a></a></li><li><a href=#basix---update-mdspan-mergedhttpsgithubcomfenicsbasixpull840>Basix - Update mdspan <a href=https://github.com/FEniCS/basix/pull/840>(Merged)</a></a></li><li><a href=#dolfinx---make-compile-time-options-compile-time-constants-mergedhttpsgithubcomfenicsdolfinxpull3246>DOLFINx - Make compile time options compile time constants <a href=https://github.com/FEniCS/dolfinx/pull/3246>(Merged)</a></a></li><li><a href=#dolfinx---some-updates-for-mesh-generation-openhttpsgithubcomfenicsdolfinxpull3275>DOLFINx - Some updates for mesh generation <a href=https://github.com/FEniCS/dolfinx/pull/3275>(Open)</a></a></li><li><a href=#basix---update-to-stdranges-usage-mergedhttpsgithubcomfenicsbasixpull837>Basix - Update to std::ranges usage <a href=https://github.com/FEniCS/basix/pull/837>(Merged)</a></a></li><li><a href=#basix---c23-support-revertedhttpsgithubcomfenicsbasixpull838>Basix - C++23 Support <a href=https://github.com/FEniCS/basix/pull/838>(Reverted)</a></a></li><li><a href=#dolfinx---update-to-stdranges-usage>DOLFINx - Update to <code>std::ranges</code> usage</a></li><li><a href=#rework-radix_sort-mergedhttpsgithubcomfenicsdolfinxpull3313>Rework <code>radix_sort</code> <a href=https://github.com/FEniCS/dolfinx/pull/3313>(Merged)</a></a></li><li><a href=#favor-exterior_facet_indices-over-locate_entities_boundary-for-retrieving-complete-boundary-mergedhttpsgithubcomfenicsdolfinxpull3283>Favor <code>exterior_facet_indices</code> over <code>locate_entities_boundary</code> for retrieving complete boundary <a href=https://github.com/FEniCS/dolfinx/pull/3283>(Merged)</a></a></li><li><a href=#some-other-stritcly-maintenance-prs>Some other stritcly maintenance PR&rsquo;s</a></li></ul></li></ul></nav></aside><div class="post-nav thin"></div><div id=comments class=thin></div></main><footer id=site-footer class="section-inner thin animated fadeIn faster"><p>&copy; 2024 <a href=https://schnellerhase.github.io/>schnellerhase</a>
&#183; CC BY-NC-SA 4.0
&#183; Made with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>
&#183; Theme <a href=https://github.com/1bl4z3r/hermit-V2 target=_blank rel=noopener>Hermit-V2</a></p></footer><script async src=https://schnellerhase.github.io/js/bundle.min.c7c384e4d29d192bbac6811ae4660bb01767194a5bea56baca77e8260f93ea16.js integrity="sha256-x8OE5NKdGSu6xoEa5GYLsBdnGUpb6la6ynfoJg+T6hY=" crossorigin=anonymous></script><script async src=https://schnellerhase.github.io/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin=anonymous></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script>
<script type=text/javascript id=MathJax-script async src=https://schnellerhase.github.io/js/mathjaxs.min.ca29e9d446b2a6cb6c6e3eb0d47e9693f5c306c146eaccb43047afbf31b07a6f.js integrity="sha256-yinp1Eaypstsbj6w1H6Wk/XDBsFG6sy0MEevvzGwem8=" crossorigin=anonymous></script></body></html>